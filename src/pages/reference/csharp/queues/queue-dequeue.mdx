export const description =
  "Reference for Nitric's .NET library - Receive tasks from a queue."

# .NET - Queue.Dequeue()

Dequeue messages.

```csharp
class UserRequest
{
    public string UserId { get; set; }
    public string Message { get; set; }
}

var queue = Nitric.Sdk.Nitric.Queue<UserRequest>("batch").With(QueuePermission.Dequeue);

var tasks = queue.Dequeue();

tasks.ForEach(task => {
    // Work on a task...
    Console.WriteLine($"Request from user {task.Message.UserId}: {task.Message.Message}");

    // Complete the task
    task.Complete();
});

Nitric.Sdk.Nitric.Run();
```

## Parameters

<Properties>
  <Property name="depth" type="int">
    The maximum number of tasks to receive from the queue. Defaults to 1.
  </Property>
</Properties>

## Notes

### Completing tasks

Since the process is async, the queue doesn't know when a task has been completed. So failed function/containers don't result in lost tasks, tasks are not removed from a queue when they're received.

Instead, tasks are hidden and receivers are granted a temporary lease for each task they receive.

When complete, the receiver must tell the queue the task was completed successfully, which will remove it from the queue and stop it being reprocessed.

<Note>
  Failing to complete a task before the lease expires will result in it being
  re-queued.
</Note>

To notify the queue that a task was completed call the `Complete()` method on the task reference.

### Dequeue depth

When calling `Dequeue()` a depth parameter can be provided, e.g. `Dequeue(5)`. This will _attempt_ to dequeue up to 5 messages from the queue.

However, if the queue is empty or less than 5 messages are available on the queue, then the maximum that are currently available will be returned.

This means calls to dequeue will return between 0 and _depth_ tasks.

## Examples

### Receive tasks from a queue

```csharp
class UserRequest
{
    public string UserId { get; set; }
    public string Message { get; set; }
}


var queue = Nitric.Sdk.Nitric.Queue<UserRequest>("batch").With(QueuePermission.Dequeue);

// Receive tasks with a limit of 10
var tasks = queue.Dequeue(10);

tasks.ForEach(task => {
  // Work on a task...
  Console.WriteLine($"Request from user {task.Message.UserId}: {task.Messsage.Message}");

  // Complete the task
  task.Complete();
});

Nitric.Sdk.Nitric.Run();
```
